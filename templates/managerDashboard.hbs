<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manager Dashboard</title>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>
</head>
<body>
    <h1>Manager Dashboard</h1>
    <table id="procurementTable" class="display">
        <thead>
            <tr>
                <th>Produce Name</th>
                <th>Dealer Name</th>
                <th>Type</th>
                <th>Cost</th>
                <th>Date</th>
                <th>Branch Name</th>
                <th>Time</th>
                <th>Tonnage</th>
                <th>Phone</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <script>
        $(document).ready(function () {
            var table = $('#procurementTable').DataTable({
                "ajax": {
                    "url": "/fetchProcurementData",
                    "dataSrc": ""
                },
                "columns": [
                    { "data": "produceName" },
                    { "data": "dealerName" },
                    { "data": "Type" },
                    { "data": "Cost" },
                    { "data": "Date" },
                    { "data": "BranchName" },
                    { "data": "Time" },
                    { "data": "Tonnage" },
                    {"data": "phone"},
                    {
                        "data": null,
                        "defaultContent": "<button class='edit-btn'>Edit</button>"
                    }
                ]
            });

            $('#procurementTable tbody').on('click', '.edit-btn', function () {
                var data = table.row($(this).parents('tr')).data();
                openEditModal(data);
            });
        });

        function openEditModal(data) {
            $('#editModal').find('input[name="_id"]').val(data._id);
            $('#editModal').find('input[name="produceName"]').val(data.produceName);
            $('#editModal').find('input[name="dealerName"]').val(data.dealerName);
            $('#editModal').find('input[name="Type"]').val(data.Type);
            $('#editModal').find('input[name="Cost"]').val(data.Cost,);
            $('#editModal').find('input[name="Date"]').val(data.Date);
            $('#editModal').find('input[name="BranchName"]').val(data.BranchName);
            $('#editModal').find('input[name="Time"]').val(data.Time);
            $('#editModal').find('input[name="Tonnage"]').val(data.Tonnage);
            $('#editModal').find('input[name="phone"]').val(data.phone);
            $('#editModal').css('display', 'block');
        }

        $(document).ready(function () {
            $('#editForm').on('submit', function (event) {
                event.preventDefault();
                var formData = $(this).serialize();
                $.ajax({
                    url: '/updateProcurementData',
                    type: 'POST',
                    data: formData,
                    success: function (response) {
                        alert('Data updated successfully!');
                        $('#editModal').css('display', 'none');
                        $('#procurementTable').DataTable().ajax.reload();
                    },
                    error: function (error) {
                        alert('Error updating data');
                    }
                });
            });
        });
    </script>

    <div id="editModal" class="modal">
        <div class="modal-content">
            <h2>Edit Procurement Data</h2>
            <form id="editForm">
                <input type="hidden" name="_id">
                <label for="produceName">Produce Name:</label>
                <input type="text" name="produceName" required>
                <label for="dealerName">Dealer Name:</label>
                <input type="text" name="dealerName" required>
                <label for="Type">Type:</label>
                <input type="text" name="Type" required>
                <label for="Cost">Cost:</label>
                <input type="text" name="Cost" required>
                <label for="Date">Date:</label>
                <input type="date" name="Date" required>
                <label for="BranchName">Branch Name:</label>
                <input type="text" name="BranchName" required>
                <label for="Time">Time:</label>
                <input type="date" name="Time" required>
                <label for="Tonnage">Tonnage:</label>
                <input type="text" name="Tonnage" required>
                <label for="phone">Phone:</label>
                <input type="phone" name="phone" required>
                <button type="submit">Save</button>
            </form>
        </div>
    </div>

    <style>
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0,0,0);
            background-color: rgba(0,0,0,0.4);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }
    </style>
</body>
</html>