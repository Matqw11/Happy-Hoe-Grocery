<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Page</title>
    <link rel="stylesheet" href="/styles/admin.css" />
    <link rel="stylesheet" href="/styles/procurement.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
</head>

<body>
    <div class="container">
        <div class="sidebar">
            <div class="sidebar-top">
                <div class="sidebar-content">
                    <img src="/assets/view-dashboard.svg" alt="dashboard icon" />
                    <h1><a href="">Happy Hoe Grocery</a></h1>
                </div>
            </div>
            <div class="sidebar-middle">
                <div class="sidebar-content">
                    <img src="/assets/home-variant.svg" alt="home" />
                    <h2><a href="/">Home</a></h2>
                </div>
                <div class="sidebar-content">
                    <img src="/assets/card-account-details-outline.svg" alt="profile" />
                    <h2><a href="/salesPage">Sales</a></h2>
                </div>
                <div class="sidebar-content">
                    <img src="/assets/message.svg" alt="messages" />
                    <h2><a href="/managerDashboard">Manager Dashboard </a></h2>
                </div>
                <div class="sidebar-content">
                    <img src="/assets/clock-time-three.svg" alt="history" />
                    <h2><a href="/procurementPage">Procurement Pages</a></h2>
                </div>
            </div>
            <div class="sidebar-bottom">
                <div class="sidebar-content">
                    <img src="/assets/cog.svg" alt="settings" />
                    <h2><a href="">Settings</a></h2>
                </div>
                <div class="sidebar-content">
                    <img src="/assets/shield-check.svg" alt="support" />
                    <h2><a href="">Privacy</a></h2>
                </div>
                <div class="sidebar-content">
                    <img src="/assets/help-box.svg" alt="privacy" />
                    <h2><a href="">Support</a></h2>
                </div>
            </div>
        </div>
        <div class="main-content">
            <div class="header">
                <div class="header-left">
                    <div>
                        <p><strong>Welcome to Happy Hoe Grocery</strong></p>
                        <h2><strong>Sales Page</strong></h2>
                    </div>
                </div>
                <div class="header-right">
                    <div class="profile-info">
                        <img src="/assets/bell-ring-outline.svg" alt="bell notification icon" />
                        <p><strong>Welcome, {{user.username}}!</strong></p>
                        <p>Branch: {{user.branch}}</p>
                    </div>
                    <div class="actions">
                        <button type="button" onclick="signOut()">Sign out</button>
                    </div>
                </div>
            </div>
            <div class="sales-content">
                <div class="form-container">
                    <h1>SALES</h1>
                    <form action="/salesPage" method="POST">
                        <div class="sales-grid">
                            <div class="form-group">
                                <input class="form-input" type="text" id="buyerName" placeholder="Buyer Name" name="buyerName" required>
                                <input class="form-input" type="text" id="salesAgentName" placeholder="Sales Agent Name" name="salesAgentName" value="{{user.username}}" readonly>
                            </div>
                            <div class="form-group">
                                <input class="form-input" type="text" id="nationalId" placeholder="National ID" name="nationalId" required>
                                <input class="form-input" type="date" id="dueDate" placeholder="Due Date" name="dueDate" required>
                            </div>
                            <div class="form-group">
                                <select class="form-input" id="produceName" name="produceName" required>
                                    <option value="">Select Product</option>
                                    {{#each products}}
                                        <option value="{{this.name}}" data-tonnage="{{this.tonnage}}">{{this.name}} ({{this.tonnage}} tonnes available)</option>
                                    {{/each}}
                                </select>
                                <input class="form-input" type="number" id="tonnage" placeholder="Tonnage" name="tonnage" required min="0" step="0.01">
                            </div>
                            <div class="form-group">
                                <input class="form-input" type="tel" id="phone" placeholder="Phone" name="phone" required>
                                <input class="form-input" type="text" id="type" placeholder="Type" name="type" required>
                            </div>
                            <div class="form-group">
                                <input class="form-input" type="number" id="amountDue" placeholder="Amount Due" name="amountDue" required>
                                <input class="form-input" type="number" id="tonnage" placeholder="Tonnage" name="tonnage" required>
                            </div>
                        </div>
                        <div class="buttons">
                            <button type="button" class="cancel-btn">CANCEL</button>
                            <button type="submit" class="save-btn">SAVE</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        function signOut() {
            if (confirm("Are you sure you want to sign out?")) {
                fetch('/signout', {
                    method: 'POST',
                    credentials: 'same-origin'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        window.location.href = '/';
                    } else {
                        alert('Failed to sign out. Please try again.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while signing out. Please try again.');
                });
            }
        }

        document.getElementById('produceName').addEventListener('change', function() {
            const selectedOption = this.options[this.selectedIndex];
            const availableTonnage = parseFloat(selectedOption.dataset.tonnage);
            const tonnageInput = document.getElementById('tonnage');
            tonnageInput.max = availableTonnage;
            tonnageInput.placeholder = `Tonnage (max ${availableTonnage})`;
        });

        document.querySelector('form').addEventListener('submit', function(e) {
            const tonnageInput = document.getElementById('tonnage');
            const selectedOption = document.getElementById('produceName').options[document.getElementById('produceName').selectedIndex];
            const availableTonnage = parseFloat(selectedOption.dataset.tonnage);
            
            if (parseFloat(tonnageInput.value) > availableTonnage) {
                e.preventDefault();
                alert('Tonnage cannot exceed available amount');
            }
        });
    </script>
</body>

</html>
